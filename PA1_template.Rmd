---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

<!-- Please set your working directory to this script's location :) -->

## Loading and preprocessing the data

```{r}

library(dplyr)
library(ggplot2)
library(lubridate)

DataFilePath<-'activity.csv'
if(!file.exists(DataFilePath))
{
  unzip('activity.zip')
}
StepData<-read.csv(DataFilePath)

# General formatting and output options.
options(scipen=1, digits=3)
HistBinCount<-10

```


## What is mean total number of steps taken per day?

```{r}

# Function for computing total step values..
# Returns a list with the values we care about.
ComputeStepInfo<-function(stepData)
{

  # Remove all observations that don't include steps.
  # We will then group these items into individual days.
  perDay<-group_by(stepData, date)

  # From there, we can easily summarizethe total number of steps that we taken per day.
  tspd<-summarise(perDay, Total=sum(steps))

#  meanTotalSteps<-mean(tspd$Total)
#  medTotalSteps<-median(tspd$Total)

  list(totalByDay=tspd, mean=mean(tspd$Total), median=median(tspd$Total))  
}


StepOnly<-filter(StepData, !is.na(steps))
stepStats<-ComputeStepInfo(StepOnly)
tspd<-stepStats$totalByDay

# PlotSteps(tspd, "Steps Per Day", HistBinCount)


# I wish I could make this into a function....
stepRange<-dist(range(tspd$Total))[[1]]
binWidth<- stepRange / HistBinCount

ggplot(data=tspd, aes(tspd$Total)) + 
       geom_histogram(binwidth=binWidth, fill="lightBlue", color="darkBlue") +
       ggtitle("Steps Per Day") +
       xlab("Total Steps") +
       ylab("Count")


```

Interesting Information:  
1. Mean Total Steps per Day: **`r stepStats$mean`**  
2. Median Total Steps per Day: **`r stepStats$median`**

## What is the average daily activity pattern?

```{r}

# Group the samples by their interval ID, and then get their mean values.
ByInterval<-group_by(StepOnly, interval)

# Get mean steps per interval.
mspi<-summarise(ByInterval, mean=mean(steps))

# Let's create a resonable looking x-axis that better denotes time.
# We are assuming that the day starts at midnight, and the data seems to support this since there are
# few steps at this time (i.e. sleeping)

breakCount<-6
MAX<-2400
breaks<-seq(from=0, by=(MAX/breakCount), length=breakCount)
xlabs<-paste(breaks / 100, "00", sep=":")

# Add the final values for the breaks/labels.
# This just makes the axis look a bit nicer.
breaks<-append(breaks, 2355)
xlabs<-append(xlabs, "23:55")

# And now we plot.
ggplot(data=mspi, aes(x = interval, y=mean)) + 
       geom_line() +
       scale_x_discrete(limits=breaks, breaks=breaks, labels=xlabs) +
       xlab("Time of Day") +
       ylab("Mean Steps") +
       ggtitle("Daily Mean of Steps per Interval")


# Finally, we can decide which interval has the highest average across all days
maxIndex = which.max(mspi$mean)
maxInterval = mspi$interval[[maxIndex]]


```

The interval with the highest mean number of steps is: **`r maxInterval`**

## Imputing missing values

```{r}
naCount<-sum(is.na(StepData$steps))
```

There are 'r naCount' missing values in the original data set.

<!-- We already have the interval means, so we are going to use those to impute the missing values -->
```{r}

# Determine the row indexes of the missing values, and using their interval, lookup 
# the corresponding mean step value.
missing<-which(is.na(StepData$steps))
match<-StepData[missing,"interval"]
fillSteps<-mspi[mspi$interval %in% match, "mean"]

# Now we can backfill the missing data in a new data set.
# We truncate the data a small amount so that we don't have partial steps, i.e. it doesn't make sense for
# someone to have taken 1.18 steps in a day.
FixedSteps<-StepData
FixedSteps[missing,"steps"]<-trunc(fillSteps$mean)

fixedStepStats<-ComputeStepInfo(FixedSteps)
tspd<-stepStats$totalByDay

# I wish I could make this into a function....
stepRange<-dist(range(tspd$Total))[[1]]
binWidth<- stepRange / HistBinCount

ggplot(data=tspd, aes(tspd$Total)) + 
       geom_histogram(binwidth=binWidth, fill="pink", color="darkRed") +
       ggtitle("Steps Per Day (fixed)") +
       xlab("Total Steps") +
       ylab("Count")



meanDiff<-stepStats$mean-fixedStepStats$mean
medianDiff<-stepStats$median-fixedStepStats$median


```

After fixing the missing values, the mean and medians are slightly different:  
Fixed Mean: **`r fixedStepStats$mean `**  
Fixed Median: **`r fixedStepStats$median `**

We can easily see that imputing the missing values has had a small impact, but not a significant one:  
Mean Difference: **`r meanDiff `** (`r (meanDiff/fixedStepStats$mean)*100`%)  
Median Difference: **`r medianDiff `** (`r (medianDiff/fixedStepStats$median)*100`%)

## Are there differences in activity patterns between weekdays and weekends?



